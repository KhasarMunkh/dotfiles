#!/usr/bin/env bash

selected="$(find "$HOME/Code" -maxdepth 2 -mindepth 1 -type d | fzf)"
[[ -z "$selected" ]] && exit 0

selected_name="$(basename -- "$selected" | tr ".,: " "____")"

switch_to() {
  if [[ -z "${TMUX:-}" ]]; then
    tmux attach-session -t "$selected_name"
  else
    tmux switch-client -t "$selected_name"
  fi
}

if tmux has-session -t="$selected_name" 2>/dev/null; then
  switch_to
else
  tmux new-session -ds "$selected_name" -c "$selected" -n nvim
  tmux new-window  -t "$selected_name":2 -n scratch -c "$selected"
  tmux select-window -t "$selected_name":1
  tmux send-keys    -t "$selected_name":1 'nvim' C-m
  switch_to
fi
